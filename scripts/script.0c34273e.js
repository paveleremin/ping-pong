"use strict";angular.module("app.env",[]).constant("env",{apiBase:""}),angular.module("app.configs",[]).config(["$urlRouterProvider",function(a){a.otherwise("/")}]),angular.module("app.resources",[]).service("api",function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function b(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}return{guid:b}}).service("userApi",["api","localStorageService",function(a,b){return{all:function(){return b.get("users")||[]},get:function(a){return this.all().filter(function(b){return b.id==a})[0]},save:function(c){c.createdAt=Date.now(),c.id=a.guid();var d=this.all();d.push(c),b.set("users",d)}}}]).service("gameApi",["api","localStorageService",function(a,b){return{all:function(){return b.get("games")||[]},get:function(a){return this.all().filter(function(b){return b.id==a})[0]},save:function(c){c.createdAt=Date.now(),c.id=a.guid();var d=this.all();d.push(c),b.set("games",d)},remove:function(a){var c=this.all(),d=-1;angular.forEach(c,function(b,c){b.id==a&&(d=c)}),-1!=d&&(c.splice(d,1),b.set("games",c))}}}]),angular.module("app",["ui.router","LocalStorageModule","mgcrea.ngStrap.typeahead","app.env","app.configs","app.resources","app.UserList","app.UserAdd","app.GameList","app.GameAdd"]),function(a){var b=function(b){function c(b,c){var d={wons:0,lost:0};return(b.u1==c.id||b.u2==c.id)&&a.forEach(b.scores,function(a){a.u1!=a.u2&&(c.id==b.u1?a.u1>a.u2?d.wons++:d.lost++:a.u2>a.u1?d.wons++:d.lost++)}),d}var d=this,e=b.users,f=b.games;a.forEach(e,function(b){a.forEach(f,function(a){var d=c(a,b);b.wons=d.wons,b.lost=d.lost})}),d.users=b.users,d.wonsPercent=function(a){return a.wons?a.lost?Math.round(a.wons/a.lost*100,4):100:0}};b.$inject=["initData"],b.resolve={initData:["$q","userApi","gameApi",function(a,b,c){return a(function(a){a({users:b.all(),games:c.all()})})}]};var c=a.module("app.UserList",[]);c.controller("UserList",b),c.config(["$stateProvider",function(a){a.state("user-list",{url:"/",templateUrl:"user-list/user-list.html",controller:b,resolve:b.resolve,controllerAs:"ctrl"})}])}(angular),function(a){var b=function(a,b){var c=this;c.data={},c.onSubmit=function(){b.save(c.data),a.transitionTo("user-list")}};b.$inject=["$state","userApi"];var c=a.module("app.UserAdd",[]);c.controller("UserAdd",b),c.config(["$stateProvider",function(a){a.state("user-add",{url:"/user-add",templateUrl:"user-add/user-add.html",controller:b,controllerAs:"ctrl"})}])}(angular),function(a){var b=function(b,c){var d=this,e=b.games,f=b.users;a.forEach(e,function(b){b.u1=f.filter(function(a){return a.id==b.u1})[0],b.u2=f.filter(function(a){return a.id==b.u2})[0],b.u1.wons=0,b.u2.wons=0,b.scoresToString=[],a.forEach(b.scores,function(a){var c=a.u1>a.u2?"u1":"u2";b[c].wons++,b.scoresToString.push(a.u1+" - "+a.u2)}),b.scoresToString=b.scoresToString.join(" | ")}),d.games=e,d.remove=function(a,b){delete d.games[a],c.remove(b.id)}};b.$inject=["initData","gameApi"],b.resolve={initData:["$q","gameApi","userApi",function(a,b,c){return a(function(a){a({users:c.all(),games:b.all()})})}]};var c=a.module("app.GameList",[]);c.controller("GameList",b),c.config(["$stateProvider",function(a){a.state("game-list",{url:"/game-list",templateUrl:"game-list/game-list.html",controller:b,resolve:b.resolve,controllerAs:"ctrl"})}])}(angular),function(a){var b=function(a,b,c){var d=this;d.maxScores=5,d.users=a.users,d.data={u1:null,u2:null,scores:[{u1:null,u2:null}]},d.onSubmit=function(){c.save(d.data),b.transitionTo("user-list")},d.addSet=function(){d.data.scores!=d.maxScores&&d.data.scores.push({u1:null,u2:null})}};b.$inject=["initData","$state","gameApi"],b.resolve={initData:["$q","userApi",function(a,b){return a(function(a){a({users:b.all()})})}]};var c=a.module("app.GameAdd",[]);c.controller("GameAdd",b),c.config(["$stateProvider",function(a){a.state("game-add",{url:"/game-add",templateUrl:"game-add/game-add.html",controller:b,resolve:b.resolve,controllerAs:"ctrl"})}])}(angular);